generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model app_users {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username       String    @unique
  password       String
  real_name      String
  role           String?   @default("farmer")
  account_status String?   @default("active") // active, pending, rejected
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
}

model batches {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  batch_no       String
  variety        String
  location       String
  sowing_date    DateTime  @db.Date
  status         String?   @default("growing")

  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  user_id        String?
  records        records[]
  inspections    inspections[]
  feedbacks      feedbacks[]
}

model records {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  batch_id    String    @db.Uuid
  action_type String
  description String?
  images      String[]
  operator    String?   @default("农户")
  recorded_at DateTime? @default(now()) @db.Timestamptz(6)
  batches     batches   @relation(fields: [batch_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model base_locations {
  id   String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name String  @unique
  type String? @default("warm")
}

model base_varieties {
  id   String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name String @unique
  days Int?   @default(90)
}

model inspections {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  batch_id    String    @db.Uuid
  stage       String    @default("harvest") // planting, harvest, transport, market
  result      String    @default("pass") // pass, fail, warning
  report_data Json      @default("{}") // Stores flexible data like sugar, pesticide, images
  inspector   String?
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  batches     batches   @relation(fields: [batch_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model feedbacks {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  batch_id    String    @db.Uuid
  rating      Int       @default(5)
  content     String?
  consumer    String?   @default("Anonymous")
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  batches     batches   @relation(fields: [batch_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}
